#Important Note: Change value of secrets variable TARGET_DOMAIN.
name: Subdomain Bruteforce & DNS Enumeration

on:
  workflow_dispatch:

jobs:       
  bruteforce:
    runs-on: ubuntu-latest
    env:
      TARGET_DOMAIN: ${{ secrets.TARGET_DOMAIN }} 
      
    steps:
      - uses: actions/checkout@v2

      - name: Tools Installation and Setup
        run: |
          wget --quiet https://raw.githubusercontent.com/ValluvarSploit/Resolver/main/resolvers.txt
          git clone https://github.com/blechschmidt/massdns.git
          cd massdns/
          make
      - name: Create Wordlist
        run: |
          sed "s/$/.$TARGET_DOMAIN/" top-vuln-subdomain.txt > hosts-wordlist.txt
      - name: Combine Wordlists
        run: cat subdomain-output.txt hosts-wordlist.txt > massdns-input.txt
      - name: Run MassDNS
        run: |
         ./massdns/bin/massdns -r resolvers.txt -t A -o S -w massdns-output.txt massdns-input.txt
         cat massdns-output.txt | awk '{print $1}' | sed 's/.$//' | sort -u > hosts-online.txt
         cat massdns-output.txt | awk '{print $3}' | sort -u | grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" > ips-online.txt
      - name: Final Clean-up
        run: |
          rm resolvers.txt
          rm -rf massdns/
      - name: Commit Tool Output
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Github Action"
          git add hosts-wordlist.txt massdns-input.txt hosts-online.txt ips-online.txt
          git commit -m "Update host-wordlist.txt"
          git push "https://ValluvarSploit:${{ secrets.TOKEN }}@github.com/ValluvarSploit/Test-Data.git" HEAD:main --follow-tags
