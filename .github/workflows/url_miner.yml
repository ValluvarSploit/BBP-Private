name: URL Collector

on:
  workflow_dispatch:

jobs:
  url-collector:
    runs-on: ubuntu-latest
 
    steps:
      - uses: actions/checkout@v2
        
      - name: Tools Installation and Setup
        run: |
                 go get -u github.com/tomnomnom/gf
                 cp /home/runner/go/bin/gf .
                 git clone https://github.com/1ndianl33t/Gf-Patterns
                 mkdir ~/.gf && cp -r Gf-Patterns/*.json ~/.gf/
                 wget --quiet https://github.com/tomnomnom/qsreplace/releases/download/v0.0.1/qsreplace-linux-386-0.0.1.tgz
                 tar xvf qsreplace-linux-386-0.0.1.tgz
                 go get github.com/tomnomnom/waybackurls
                 cp /home/runner/go/bin/waybackurls .
                 wget --quiet https://github.com/lc/gau/releases/download/v1.1.0/gau_1.1.0_linux_amd64.tar.gz
                 tar xvf gau_1.1.0_linux_amd64.tar.gz
                              
      - name: Remove Old files
        run: |       
#                rm urls-output.txt.zip.xz urls-output.txt rm xss-params.txt sqli-params.txt

      - name: waybackurls
        run: |
                 ./waybackurls "$TARGET_DOMAIN" | tee waybackurls-output.txt 

      - name: gau
        run: |
                 echo "$TARGET_DOMAIN" | ./gau | tee gau-output.txt
                
      - name: Combine Output Files
        run: |
                 cat waybackurls-output.txt gau-output.txt | tee urls-output.txt
                 sort -u urls-output.txt -o urls-output.txt
                 cat urls-output.txt | grep "=" | egrep -iv ".(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt|js)" | tee temp-output.txt
                 cat temp-output.txt | ./qsreplace FUZZ | tee -a unique-url-output.txt
                 rm temp-output.txt
 
      - name: Patterns
        run: |
                 cat urls-output.txt | ./gf interestingEXT | tee -a interestingEXT-params.txt
                 cat urls-output.txt | ./gf jsvar | tee -a jsvar-params.txt          
                 cat unique-url-output.txt | ./gf interestingparams | tee -a interestingparams-params.txt
                 cat unique-url-output.txt | ./gf xss | tee -a xss-params.txt
                 cat unique-url-output.txt | ./gf sqli | tee -a sqli-params.txt          
                 cat unique-url-output.txt | ./gf lfi | tee -a lfi-params.txt          
                 cat unique-url-output.txt | ./gf ssrf | tee -a ssrf-params.txt          
                 cat unique-url-output.txt | ./gf redirect | tee -a redirect-params.txt          
                 cat unique-url-output.txt | ./gf ssti | tee -a ssti-params.txt          
                 cat unique-url-output.txt | ./gf rce | tee -a rce-params.txt          
                 cat unique-url-output.txt | ./gf idor | tee -a idor-params.txt          
                 cat unique-url-output.txt | ./gf debug_logic | tee -a debug_logic-params.txt
                 cat unique-url-output.txt | ./gf img-traversal | tee -a img-traversal-params.txt
                 cat unique-url-output.txt | ./gf interestingsubs | tee -a interestingsubs-params.txt
                          
      - name: Compress Output File
        run: |
                 ls -lh urls-output.txt
                 zip urls-output.txt.zip urls-output.txt
                 ls -lh urls-output.txt.zip
                 xz urls-output.txt.zip
                 ls -lh urls-output.txt.zip.xz
                 xz -d urls-output.txt.zip.xz
                 ls -lh
                 unzip urls-output.txt.zip
                 ls -lh

      - name: Remove Installation Files
        run: |
                 rm -rf Gf-Patterns/
                 rm LICENSE README.md gau gau_1.1.0_linux_amd64.tar.gz temp-2.txt waybackurls-output.txt gau-output.txt qsreplace-linux-386-0.0.1.tgz gf waybackurls
                 
      - name: Commit Tool Output
        run: |
                 git config --local user.email "action@github.com"
                 git config --local user.name "Github Action"
                 git add idor-params.txt debug_logic-params.txt img-traversal-params.txt interestingEXT-params.txt interestingsubs-params.txt unique-url-output.txt xss-params.txt sqli-params.txt lfi-params.txt ssrf-params.txt redirect-params.txt ssti-params.txt rce-params.txt jsvar-params.txt
                 git commit -m "Update urls-output.txt.zip.xz"
                 git push "https://ValluvarSploit:${{ secrets.TOKEN }}@github.com/ValluvarSploit/Test-Data.git" HEAD:main --follow-tags
#
