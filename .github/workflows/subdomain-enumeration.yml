# Before running this action, make sure you updated following secrets variables in settings.
#  1. DOMAIN
#       example.com
name: Subdomain Enumeration
on:
  workflow_dispatch:
env:
     TARGET_DOMAIN: ${{ secrets.DOMAIN }}
     SLACK_OAUTH_TOKEN: ${{ secrets.SLACK_OAUTH_USER_TOKEN }}
     SLACK_CHANNEL_NAME: ${{ secrets.SLACK_CHANNEL_NAME }}
jobs:
  subdomain-enumeration:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Dependencies
        run: |
         go get -u github.com/tomnomnom/assetfinder && cp /home/runner/go/bin/assetfinder .
         sudo snap install amass
         wget --quiet https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 && mv jq-linux64 jq && chmod +x jq
         wget --quiet https://github.com/Findomain/Findomain/releases/download/2.1.5/findomain-linux && mv findomain-linux findomain && chmod +x findomain
         wget --quiet https://github.com/projectdiscovery/subfinder/releases/download/v2.4.5/subfinder_2.4.5_linux_amd64.tar.gz && tar -xzvf subfinder_2.4.5_linux_amd64.tar.gz
      - name: Certspotter
        run: curl -s "https://api.certspotter.com/v1/issuances?domain="$TARGET_DOMAIN"&expand=dns_names" | ./jq '.[].dns_names[]' | sed 's/\"//g' | sed 's/\*\.//g' | grep "$TARGET_DOMAIN" | uniq | tee output.txt
      - name: Amass
        run: amass enum -passive -d "$TARGET_DOMAIN" >> output.txt
      - name: Assetfinder
        run: ./assetfinder --subs-only "$TARGET_DOMAIN" -silent >> output.txt                                 
      - name: Crt.sh
        run: curl https://crt.sh/?q=%."$TARGET_DOMAIN" | grep "$TARGET_DOMAIN" | cut -d '>' -f2 | cut -d '<' -f1 | grep -v " " | uniq >> output.txt     
      - name: Findomain
        run: ./findomain -t "$TARGET_DOMAIN" -q >> output.txt       
      - name: Subfinder
        run: ./subfinder -d "$TARGET_DOMAIN" -all --silent >> output.txt  
      - name: Unique subdomains
        run: cat output.txt | sed 's/\*\.//g' | sort -u > subdomains-tools-output.txt
      - name: Send Subdomain Tools Output Files to Slack
        run: curl https://slack.com/api/files.upload -F token="$SLACK_OAUTH_TOKEN" -F channels="$SLACK_CHANNEL_NAME" -F title=Tools-Subdomains -F filename=tools-subdomains.txt -F file=@subdomains-tools-output.txt
    
  amass-brute:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Dependencies
        run: |
         sudo snap install amass  
         wget --quiet https://raw.githubusercontent.com/ValluvarSploit/Resolver/main/resolvers.txt
      - name: Amass
        run: |
         amass enum -active -brute -d "$TARGET_DOMAIN" -dir amass_out -rf resolvers.txt -max-dns-queries 3000
         cp amass_out/amass.txt .
      - name: Send Subdomain Tools Output Files to Slack
        run: curl https://slack.com/api/files.upload -F token="$SLACK_OAUTH_TOKEN" -F channels="$SLACK_CHANNEL_NAME" -F title=Amass -F filename=amass.out -F file=@amass.txt
 
